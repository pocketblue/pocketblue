# local/dev Justfile: commands you run interactively while hacking

build-qemu qemu_device="qemu" qemu_desktop="tty" image="" type="qcow2":
    # replicate top-level build-qemu logic but run through tests/Justfile context
    if [ -z "{{image}}" ]; then
        IMAGE="{{registry}}/{{qemu_device}}-{{qemu_desktop}}:{{tag}}"
        echo "==> building container image: $IMAGE"
        just device={{qemu_device}} desktop={{qemu_desktop}} build
    else
        IMAGE="{{image}}"
    fi
    just disk "$IMAGE" "{{type}}" "ext4"

qemu path="output/qcow2/disk.qcow2" memory="4096":
    test -f {{path}} || { echo "disk image not found: {{path}} \nRun 'just build-qemu' first"; exit 1; }
    QEMU_CPU={{qemu_cpu}} ./tests/bin/run-qemu.sh {{path}} {{memory}}

qemu-smoke:
    # runs the qemu smoke test locally (identical to CI target)
    just -f tests/ci/Justfile ci-qemu-smoke

clean:
    rm -rf output/

clean-all:
    just -f tests/ci/Justfile ci-clean-all
