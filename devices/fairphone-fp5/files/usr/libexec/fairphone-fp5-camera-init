#!/bin/bash

echo "Fairphone 5 Camera initialization..."

modprobe -q v4l2-cci 2>/dev/null || true
modprobe -q qcom-camss 2>/dev/null || true
modprobe -q s5kjn1 2>/dev/null || true
modprobe -q imx858 2>/dev/null || true
modprobe -q imx471 2>/dev/null || true
modprobe -q dw9719 2>/dev/null || true

timeout=15
waited=0
while [ $waited -lt $timeout ]; do
    if ls /dev/media* &>/dev/null; then
        echo "Media devices found after ${waited}s"
        break
    fi
    sleep 1
    ((waited++))
done

echo "=== Video devices ==="
ls -la /dev/video* 2>/dev/null || echo "None"

echo "=== Media devices ==="
ls -la /dev/media* 2>/dev/null || echo "None"

echo "=== V4L sub-devices ==="
ls -la /dev/v4l-subdev* 2>/dev/null || echo "None"

exit 0
