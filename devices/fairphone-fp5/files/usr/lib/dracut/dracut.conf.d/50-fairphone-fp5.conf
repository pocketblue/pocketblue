# Fairphone 5 (QCM6490/SC7280) dracut configuration
#
# Note: Most drivers are built into the kernel (=y) and don't need to be
# added via add_drivers. This includes:
# - Touchscreen: goodix_berlin_core, goodix_berlin_spi
# - Type-C mux: fsa4480, ptn36502
# - UFS storage: ufs_qcom, ufshcd_pltfrm, ufshcd_core, phy_qcom_qmp_ufs
# - Remoteproc: qcom_q6v5_pas, qcom_pil_info, qcom_sysmon
# - GLINK/QRTR: qcom_glink, qcom_glink_rpm, qcom_smd, qrtr, qrtr_smd
# - Bluetooth: hci_uart, btqca

# Firmware for initramfs - include all device-specific firmware
install_optional_items+=" /usr/lib/firmware/qcom/qcm6490/fairphone5/* "
install_optional_items+=" /usr/lib/firmware/qcom/a660_sqe.fw /usr/lib/firmware/qcom/a660_gmu.bin "

# Bluetooth firmware - WCN6750 (QCA)
install_items+=" /usr/lib/firmware/qca/msbtfw11.mbn "
install_items+=" /usr/lib/firmware/qca/msnv11.bin "
install_optional_items+=" /usr/lib/firmware/qca/msbtfw11.tlv "

# NSS files for group/user resolution in initramfs
install_items+=" /etc/passwd /etc/group /etc/shadow /etc/nsswitch.conf "
install_items+=" /usr/lib64/libnss_files.so.2 /lib64/libnss_files.so.2 "
install_optional_items+=" /usr/lib64/libnss_compat.so.2 /lib64/libnss_compat.so.2 "

# Panel driver (may be built-in or module depending on config)
install_optional_items+=" /usr/lib/modules/*/kernel/drivers/gpu/drm/panel/panel-raydium-rm692e5.ko* "

# SPI/I2C bus drivers (often built-in, but include if modules)
install_optional_items+=" /usr/lib/modules/*/kernel/drivers/spi/spi-geni-qcom.ko* "
install_optional_items+=" /usr/lib/modules/*/kernel/drivers/i2c/busses/i2c-qcom-geni.ko* "

# Filesystems
filesystems+=" ext4 f2fs btrfs xfs "

# Dracut modules
add_dracutmodules+=" systemd systemd-initrd base rootfs-block dm ostree "

compress="zstd"
dracut_rescue_image="no"
hostonly="no"
hostonly_cmdline="no"
