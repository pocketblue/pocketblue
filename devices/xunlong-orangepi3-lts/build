#!/usr/bin/env bash

set -uexo pipefail

cp -arfT files/etc /etc
cp -arfT files/usr /usr

dnf -y install \
    hciattach-opi \
    uwe5622-firmware \
    armbian-led-state \
    gdisk

mkdir -p /boot/dtb
dnf -y remove \
    kernel \
    kernel-core \
    kernel-modules \
    kernel-modules-core
rm -rf /usr/lib/modules/*
dnf -y install kernel
rm -r /boot/dtb

systemctl disable fstrim.timer
systemctl mask fstrim.timer

systemctl --no-reload enable sprd-bluetooth.service
systemctl --no-reload enable aw859a-wifi.service
systemctl --no-reload enable armbian-led-state.service
systemctl --no-reload enable repart-root-disk.service

echo 123456 | passwd root --stdin
