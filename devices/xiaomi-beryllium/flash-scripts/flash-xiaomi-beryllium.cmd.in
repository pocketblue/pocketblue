@echo on
setlocal EnableExtensions EnableDelayedExpansion

set panel=@panel@
REM tianma/ebbg

where fastboot || (pause & exit)

echo 'waiting for device to appear in fastboot'
fastboot getvar product 2>&1 | findstr /i beryllium || (pause & exit)
fastboot erase dtbo                                 || (pause & exit)
fastboot flash boot     images/u-boot-%panel%.img   || (pause & exit)
fastboot flash cust     images/fedora_esp.raw       || (pause & exit)
fastboot flash system   images/fedora_boot.raw      || (pause & exit)
fastboot flash userdata images/fedora_rootfs.raw    || (pause & exit)

echo 'rebooting (this may take a while, DO NOT DISCONNECT THE DEVICE)'
fastboot reboot
pause
