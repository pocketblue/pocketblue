ARG from
FROM $from

COPY etc/ /etc/
COPY usr/ /usr/

# kernel
RUN mkdir /boot/dtb && \
    dnf -y remove kernel && \
    dnf -y install kernel kernel-modules-extra && \
    rm -rf /boot/dtb

RUN mkdir -p /usr/lib/efi/onetwothree/1.2.3.0/EFI && \
    echo 123 > /usr/lib/efi/onetwothree/1.2.3.0/EFI/123 && \
    bootupctl backend generate-update-metadata -vvv

# firmware
RUN dnf -y install \
    bcm283x-firmware \
    qcom-firmware

# qualcomm tools and libs
RUN dnf -y install \
    libssc \
    hexagonrpc \
    pd-mapper \
    pil-squasher \
    qbootctl \
    bootmac

# audio
RUN dnf -y install \
    alsa-utils \
    pipewire \
    pipewire-alsa \
    pipewire-pulseaudio \
    alsa-ucm-mobility-sdm845 \
    q6voiced
RUN systemctl enable q6voiced.service

# usb network
RUN dnf -y install \
    dnsmasq

# other
RUN dnf -y install \
    mobility-tweaks \
    buffyboard

RUN systemctl enable \
    qbootctl.service \
    bootmac-bluetooth.service \
    hexagonrpcd-sdsp.service \
    msm-modem-uim-selection.service

COPY fwload/usr/ /usr/

COPY usbnet/etc/ /etc/
COPY usbnet/usr/ /usr/

# cleanup
RUN rm -rf /var/log/* && dnf clean all

RUN bootc container lint
